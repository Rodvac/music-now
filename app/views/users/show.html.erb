<div class="dashboard-container">
  <% if current_user.studio.nil? %>
    <!-- bar nav -->
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
      <li class="nav-item underlineHoverBlack" role="presentation">
        <a class="nav-link active text-black  " id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true"> <%= current_user.bookings.count %> Réservations</a>
      </li>
      <li class="nav-item underlineHoverBlack" role="presentation">
        <a class="nav-link text-black" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">Mon Calendrier</a>
      </li>
      <li class="nav-item underlineHoverBlack" role="presentation">
        <a class="nav-link text-black" id="pills-contact-tab" data-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false">Éditez mon Profil</a>
      </li>
    </ul>

    <!-- content -->
    <div class="tab-content " id="pills-tabContent">
      <!--   Mes Reservation -->
      <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
        <div class="tabContent" id="about">
          <div class="container">
            <div class="row">
              <div class="col-lg-12 mx-auto  rounded ">
                <!-- Card Booking-->
                  <div class="cards-rooms">
                    <!--  switches with checkbox inputs-->
                    <div class="row mb-5">
                        <div class="col-lg-4">
                          <div class="card-body p-4 text-center">
                              <!-- Custom switch -->
                              <p class="custom-control custom-switch custom-switch-lg">
                                  <input class="custom-control-input" id="customSwitch7" type="checkbox" checked>
                                  <label class="custom-control-label font-italic" for="customSwitch7">Réservations à venir</label>
                              </p>
                          </div>
                        </div>
                    </div>

                    <% @current_user.bookings.each do |booking| %>
                      <% if  Time.now.strftime("%Y-%m-%d").to_date > booking.date.to_date %>
                        <div class="card-room card-room-index">
                             <%= cl_image_tag booking.room.photo.key, class: "card-studio-img" %>
                          <div class="card-room-infos">
                            <div class="studio-name">
                             <p><%= booking.room.studio.name %></p>
                            </div>
                            <div class="card-room-description">
                              <h2><%= link_to booking.room.name, booking_path(booking, Date.today) %></h2>
                              <p class="address"><%= booking.room.studio.address %></p>
                              <h4 class=" mt-2"><%= booking.date.split("-").reverse.join("/")%> (dans <%= (Time.now.strftime("%Y-%m-%d").to_date - booking.date.to_date).to_i %> jours)  </h4>

                              <p class="mt-2 capacity">  <i class="fas fa-users"></i> <%= booking.room.capacity %> </p>
                            </div>
                            <div class="card-room-gears d-flex mt-2">
                              <div class="d-flex">
                                <i class="fas fa-search"></i>
                                <a class="ml-2" data-toggle="collapse" href="#collapseExample-<%=booking.id%>" role="button" aria-expanded="false" aria-controls="collapseExample">
                                  Matériel
                                </a>
                              </div>
                            </div>
                            <div class="collapse" id="collapseExample-<%=booking.id%>">
                              <% booking.room.items.each do |item| %>
                                <p>- <%= item.name %></p>
                              <% end %>
                            </div>
                          </div>
                        </div>
                      <% else %>
                        <div class="card-room card-room-index">
                             <%= cl_image_tag booking.room.photo.key, class: "card-studio-img" %>
                          <div class="card-room-infos">
                            <div class="studio-name">
                             <p><%= booking.room.studio.name %></p>
                            </div>
                            <div class="card-room-description">
                              <h2><%= link_to booking.room.name, booking_path(booking, Date.today) %></h2>
                              <p class="address"><%= booking.room.studio.address %></p>
                              <h4 class=" mt-2"><%= booking.date.split("-").reverse.join("/")%> (passé)  </h4>

                              <p class="mt-2 capacity">  <i class="fas fa-users"></i> <%= booking.room.capacity %> </p>
                            </div>
                            <div class="card-room-gears d-flex mt-2">
                              <div class="d-flex">
                                <i class="fas fa-search"></i>
                                <a class="ml-2" data-toggle="collapse" href="#collapseExample-<%=booking.id%>" role="button" aria-expanded="false" aria-controls="collapseExample">
                                  Matériel
                                </a>
                              </div>
                            </div>
                            <div class="collapse" id="collapseExample-<%=booking.id%>">
                              <% booking.room.items.each do |item| %>
                                <p>- <%= item.name %></p>
                              <% end %>
                            </div>
                          </div>
                        </div>
                      <% end %>
                    <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--   Mon Calendrier -->
      <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
        <div class="calendar_show">
          <div class="calendar_container">
            <%= month_calendar studio: @bookings do |date, bookings| %>
              <!--display date if today's date  and not booked-->
              <% if @already_booked.pluck(:date)&.include?(date.strftime("%Y-%m-%d"))%>
                <div class="cursor" style="cursor: pointer;">
                  <div class="font-weight-bold ">
                    <%= date.day %>
                    <% booking = @already_booked.select { |e| e.date == date.to_s }.first %>
                    <p class=""> <%= link_to booking.time + " => "+booking.room.studio.name, user_booking_path(current_user, booking)  %>
                    </p>
                  </div>
                </div>
              <!--past days note proposed -->
              <% else %>
                <div class="font-weight-bold">
                  <%= date.day %>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Editer mon profil  -->
      <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
        <div class="tabContent" id="usage">
          <div class="container ptpb row">
            <div class="col-6 ">
              <% if @user.photo.attached? %>
                <%= cl_image_tag @user.photo.key, class: "avatar-xlg img-thumbnail", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false  %>
              <% else %>
                <%= image_tag "https://i.etsystatic.com/10924369/r/il/96200a/961644812/il_570xN.961644812_fohw.jpg", class: "avatar-medium dropdown-toggle ", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
              <% end %>
            </div>
            <div class="col-6">
              <%= simple_form_for @user do |f| %>
                <%= f.input :first_name, :label => "First Name" %>
                <%= f.input :last_name, :label => "Last Name" %>
                <%= f.input :email, :label => "Email" %>
                <%= f.input :current_password %>
                <%= f.input :password %>
                <%= f.input :password_confirmation %>
                <%= f.input :photo, as: :file %>
                <%= f.submit "Save", class: 'btn btn-primary mt-2' %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% else %>
    <div class="container">
      <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link active text-black" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Mes Réservations</a>
        </li>
        <li class="nav-item " role="presentation">
          <a class="nav-link text-black" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">
          <%= link_to "Mon Studio", studio_path(@studios.first)%></a>
        </li>
      </ul>
      <div class="tab-content " id="pills-tabContent">
        <!--   Editer mon profil -->
        <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
          <div class="tabContent" id="about">
            <div class="container text-center">
                <div class="row pt-5">
                    <div class="col-lg-8 mx-auto">
                        <h1 class="display-4"><%=@studios.first.name %> - Liste des réservations</h1>
                        <br>
                        <h3 class="underline">Vous avez <%= @owner_bookings.count %> réservations </h3>
                    </div>
                </div>
            </div>
            <div class="container py-5">
              <div class="row">
                <div class="col-lg-12 mx-auto bg-white rounded shadow">
                  <!-- Fixed header table-->
                  <div class="table-responsive">
                    <table class="table table-fixed">
                      <thead>
                        <tr>
                            <th scope="col" class="col-1">#</th>
                            <th scope="col" class="col-2">Date</th>
                            <th scope="col" class="col-2">Heure</th>
                            <th scope="col" class="col-2">Client</th>
                            <th scope="col" class="col-3">Room</th>
                            <th scope="col" class="col-2">Messages</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% i = 1 %>
                        <% @owner_bookings.each do |booking| %>
                          <tr>
                            <th scope="row" class="col-1"><%= link_to i, booking_path(booking) %></th>
                            <td class="col-2 bold"><%=  booking.date.split("-").pop(2).join("/") %></td>
                            <td class="col-2"><%=  booking.time %></td>
                            <td class="col-2"><%=  booking.user.first_name %></td>
                            <td class="col-3"><%=  booking.room.name %></td>
                            <th scope="col" class="col-2"><%= link_to booking.messages.count, booking_path(booking)%></th>
                            <% i += 1 %>
                          </tr>
                        <% end %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
